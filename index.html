<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Liste des Documents</title>
  <style>
    /* CSS remains the same */
  </style>
</head>
<body>
  <h1>Liste des Documents</h1>

  <!-- Formulaire de téléchargement -->
  <div class="upload-form">
    <input type="file" id="fileInput" />
    <button onclick="uploadFile()">Télécharger</button>
  </div>

  <!-- Boutons pour basculer entre les espaces -->
  <div class="space-buttons">
    <button id="btn-etudiant" onclick="showDocuments('etudiant')">Espace Étudiant</button>
    <button id="btn-enseignant" onclick="showDocuments('enseignant')">Espace Enseignant</button>
    <button onclick="searchFiles()">Rechercher Fichiers</button>
    <button onclick="showNotifyForm()">Notifier</button>
  </div>

  <!-- Liste des documents -->
  <div id="documents-container"></div>

  <!-- Formulaire de notification -->
  <div id="notify-form" style="display: none; margin: 20px;">
    <h2>Envoyer une Notification</h2>
    <textarea id="notifyMessage" placeholder="Message de la notification" rows="4" style="width: 100%;"></textarea>
    <input type="text" id="notifyTags" placeholder="Tags (séparés par des virgules)" style="width: 100%; margin-top: 10px;" />
    <button onclick="sendNotification()">Envoyer</button>
  </div>

  <script>
    const apiUrl = 'https://backend-documents-api-d9ehb3dfdzg4grey.francecentral-01.azurewebsites.net';

    // Fonction de téléchargement de fichier
    async function uploadFile() {
      const fileInput = document.getElementById('fileInput');
      if (!fileInput.files.length) {
        alert('Veuillez sélectionner un fichier à télécharger.');
        return;
      }

      const formData = new FormData();
      formData.append('file', fileInput.files[0]);

      try {
        const response = await fetch(${apiUrl}/upload, {
          method: 'POST',
          body: formData,
        });

        const result = await response.json();
        alert(result.message);
        fileInput.value = ''; // Réinitialiser le champ de fichier
        await fetchFiles(); // Rafraîchir la liste des fichiers
      } catch (error) {
        console.error('Erreur lors de l\'upload:', error);
        alert('Erreur lors de l\'upload');
      }
    }

    // Fonction pour rechercher des fichiers
    async function searchFiles() {
      try {
        const response = await fetch(${apiUrl}/search);
        const data = await response.json();

        files.etudiant = data.filter(file => file.name.includes('etudiant'));
        files.enseignant = data.filter(file => file.name.includes('enseignant'));

        alert('Recherche terminée ! Les fichiers sont mis à jour.');
        showDocuments('etudiant');
      } catch (error) {
        console.error('Erreur lors de la recherche:', error);
        alert('Erreur lors de la recherche.');
      }
    }

    // Fonction pour supprimer un fichier
    async function deleteFile(filename) {
      if (!confirm(Êtes-vous sûr(e) de vouloir supprimer le fichier : ${filename} ?)) return;

      try {
        const response = await fetch(${apiUrl}/delete/${filename}, {
          method: 'DELETE',
        });

        const result = await response.json();
        alert(result.message);
        await fetchFiles(); // Rafraîchir la liste des fichiers
      } catch (error) {
        console.error('Erreur lors de la suppression:', error);
        alert('Erreur lors de la suppression');
      }
    }

    // Fonction pour afficher le formulaire de notification
    function showNotifyForm() {
      const notifyForm = document.getElementById('notify-form');
      notifyForm.style.display = notifyForm.style.display === 'none' ? 'block' : 'none';
    }

    // Fonction pour envoyer une notification
    async function sendNotification() {
      const message = document.getElementById('notifyMessage').value;
      const tags = document.getElementById('notifyTags').value.split(',').map(tag => tag.trim());

      try {
        const response = await fetch(${apiUrl}/notify, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ message, tags }),
        });

        const result = await response.json();
        alert(result.message);
        document.getElementById('notifyMessage').value = '';
        document.getElementById('notifyTags').value = '';
      } catch (error) {
        console.error('Erreur lors de l\'envoi de la notification:', error);
        alert('Erreur lors de l\'envoi de la notification.');
      }
    }

    // Récupération et affichage des fichiers reste inchangé
    async function fetchFiles() {
      try {
        const response = await fetch(${apiUrl}/search);
        const data = await response.json();

        files.etudiant = data.filter(file => file.name.includes('etudiant'));
        files.enseignant = data.filter(file => file.name.includes('enseignant'));

        showDocuments('etudiant'); // Actualiser l'affichage
      } catch (error) {
        console.error('Erreur lors de la récupération des fichiers:', error);
      }
    }

    function renderDocuments(category) {
      const container = document.getElementById('documents-container');
      container.innerHTML = '';

      const categoryFiles = files[category];

      if (categoryFiles.length === 0) {
        container.innerHTML = '<p>Aucun fichier disponible.</p>';
        return;
      }

      const ul = document.createElement('ul');
      categoryFiles.forEach(file => {
        const li = document.createElement('li');

        const link = document.createElement('a');
        link.href = ${apiUrl}/download/${file.name};
        link.target = '_blank';
        link.textContent = file.name;

        const deleteButton = document.createElement('button');
        deleteButton.classList.add('delete-button');
        deleteButton.textContent = 'Supprimer';
        deleteButton.onclick = () => deleteFile(file.name);

        li.appendChild(link);
        li.appendChild(deleteButton);
        ul.appendChild(li);
      });

      container.appendChild(ul);
    }

    function showDocuments(space) {
      document.getElementById('btn-etudiant').disabled = (space === 'etudiant');
      document.getElementById('btn-enseignant').disabled = (space === 'enseignant');

      renderDocuments(space);
    }

    window.onload = async () => {
      await fetchFiles();
    };
  </script>
</body>
</html>
